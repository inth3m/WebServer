[TOC]

# 知识点

## eventfd
eventfd是一个用来通知事件的文件描述符
只有一个系统调用

```C
int eventfd(unsigned int initval, int flags);
```

创建一个eventfd对象,该对象是一个内核维护的无符号的64位整型计数器。初始化为initval的值。

flags是三个标志位OR的结果
-  EFD_CLOEXEC：FD_CLOEXEC，简单说就是fork子进程时不继承，对于多线程的程序设上这个值不会有错的。
- EFD_NONBLOCK：文件会被设置成O_NONBLOCK，一般要设置。
- EFD_SEMAPHORE：（2.6.30以后支持）支持semophore语义的read，简单说就值递减1。EFD_SEMAPHORE：（2.6.30以后支持）支持semophore语义的read，简单说就值递减1。

这个新建的fd的操作很简单：

read(): 读操作就是将counter值置0，如果是semophore就减1。

write(): 设置counter的值。

注意，还支持epoll/poll/select操作，当然，以及每种fd都都必须实现的close。

## pthread_once()函数

在多线程环境中，有些事仅需要执行一次。通常当初始化应用程序时，可以比较容易地将其放在main函数中。但当你写一个库时，就不能在main里面初始化了，你可以用静态初始化，但使用一次初始化（pthread_once）会比较容易些。

int pthread_once(pthread_once_t *once_control, void (*init_routine) (void))；

功能：本函数使用初值为PTHREAD_ONCE_INIT的once_control变量保证init_routine()函数在本进程执行序列中仅执行一次。